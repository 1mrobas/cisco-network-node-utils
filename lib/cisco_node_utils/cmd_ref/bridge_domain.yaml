# bridge_domain
# bridge_domain feature is available only on n7k
---
_exclude: [N3k, N5k, N6k, N8k, N9k, ios_xr]

# For the below name, shutdown commands we are going to use show running-config
# bridge-domain cli which displays as below
#
# system bridge-domain 100-110
#
# bridge-domain 100-110
#
# bridge-domain 100
#   shutdown
#   fabric-control
#   name PepsiCo
# bridge-domain 101
# bridge-domain 102
# ...
# bridge-domain 108
#   shutdown
#   name Amazon
# bridge-domain 109
#   shutdown
# bridge-domain 110
#   name Microsoft

_template:
  get_command: "show running-config bridge-domain"

all_bds:
  multiple: true
  get_value: '/^bridge-domain (\S+)/'

# Here for name match if condition is used because the underlying property is
# system bridge-domain 100
#
# bridge-domain 100
#
# bridge-domain 100
#   shutdown
#   fabric-control
#   name PepsiCo
# so we cannot use get_context: '/^bridge-domain 100/' because it will search
# for the first context and there is nothing under that. The properties are
# present in the second context. Also name could appear in any order and hence
# the if conditions.
bd_name:
  get_value: '/^bridge-domain[\s\S]*bridge-domain <bd>\s*(?:shutdown\s+fabric-control\s+name (\S+)|fabric-control\s+name (\S+)|shutdown\s+name (\S+)|name (\S+))/'
  set_context: ["bridge-domain <bd>"]
  set_value: "<state> name <name>"
  default_value: ~

create:
  set_value: "bridge-domain <crbd>"

destroy:
  set_value: "no bridge-domain <delbd> ; system bridge-domain remove <rembd>"

# Configured fabric-control Bridge-Domain/VLAN    :  100
fabric_control:
  get_command: "show bridge-domain summary"
  get_value: '/^Configured fabric-control.*:\s+(\d+)/'
  set_context: ["bridge-domain <bd>"]
  set_value: "<state> fabric-control"
  default_value: false

# Same reason as for bd_name case above
shutdown:
  get_value: '/^bridge-domain[\s\S]*bridge-domain <bd>\s*(shutdown)?/'
  set_context: ["bridge-domain <bd>"]
  set_value: "<state> shutdown"
  default_value: false

system_bd_add:
  get_value: '/^system bridge-domain (\S+)/'
  set_value: "system bridge-domain add <addbd>"
  default_value: ""
