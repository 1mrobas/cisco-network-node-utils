# show_version
---
_template:
  nxapi_structured:
    get_command: 'sh version'
  nexus:
    test_get_command: "sh version | no-more"
  ios_xr:
    cli:
      get_command: 'sh version'
    test_get_command: "sh version"

board:
  nxapi_structured:
    get_value: 'proc_board_id'

boot_image:
  _exclude: [ios_xr]
  nxapi_structured:
    get_value: "kick_file_name"
  test_get_value: '/.*NXOS image file is: (.*)$.*/'

cpu:
  nxapi_structured:
    get_value: 'cpu_name'

description:
  nxapi_structured:
    get_value: "chassis_id"
  nexus:
    '/N7K/':
      test_get_value: '/.*Hardware\n  cisco (\w+ \w+ \(\w+ \w+\) \w+).*/'
    else:
      # Hardware
      #   cisco Nexus9000 C9396PX Chassis
      #
      # Other variants for the line of interest:
      #   cisco Nexus9000 C9504 (4 Slot) Chassis ("Supervisor Module")
      #                                          ^-module_id-ignore!-^
      #   cisco Nexus3000 C3132Q Chassis
      #   cisco N3K-C3048TP-1GE
      test_get_value: '/Hardware\n  cisco (([^(\n]+|\(\d+ Slot\))+\w+)/'
  ios_xr:
    get_command: 'show inventory | inc "Rack 0"'
    get_value: '/DESCR: "(.*)"/'
    test_get_command: 'show inventory | inc "Rack 0"'
    test_get_value: '/DESCR: "(.*)"/'

full:
  get_command: "sh version"

header:
  nxapi_structured:
    get_value: "header_str"
  ios_xr:
    get_value: '/Cisco.*Software/'

host_name:
  nxapi_structured:
    get_value: "host_name"
  ios_xr:
    # not displayed in 'show version' on IOS XR
    get_command: "show running | i hostname"
    get_value: '/^hostname (.*)$/'
    default_value: 'ios'

last_reset_reason:
  _exclude: [ios_xr]
  nxapi_structured:
    get_value: "rr_reason"
  test_get_value: '/.*\nLast reset.*\n\n?  Reason: (.*)\n/'

last_reset_time:
  _exclude: [ios_xr]
  kind: string
  default_value: ''
  nxapi_structured:
    get_value: "rr_ctime"
  test_get_value: '/.*\nLast reset at \d+ usecs after  (.*)\n/'

system_image:
  _exclude: [ios_xr]
  '/N7K/':
    nxapi_structured:
      get_value: "isan_file_name"
    test_get_value: '/.*system image file is:    (.*)$.*/'
  else:
    nxapi_structured:
      get_value: "kick_file_name"
    test_get_value: '/.*NXOS image file is: (.*)$.*/'

uptime:
  nxapi_structured:
    get_value: '/uptime is (.*)/'

version:
  nxapi_structured:
    get_value: "kickstart_ver_str"
  nexus:
    test_get_value:
      - '/\nkickstart_ver_str\s+(.+)\n/'
      - '/.*NXOS:\s+version (.*)\n/'
  ios_xr:
    get_value: '/IOS XR.*Version (.*)$/'
    test_get_value: [
    ~,
    '/IOS XR.*Version (.*)$/'
    ]
