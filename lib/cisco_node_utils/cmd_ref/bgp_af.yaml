# bgp_af.yaml
---
_template:
  config_get_token: '/^router bgp <asnum>$/'
  config_get_token_append:
    - '/^vrf <vrf>$/'
    - '/^address-family <afi> <safi>$/'
  config_set: "router bgp <asnum>"
  config_set_append:
    - ' vrf <vrf>'
    - ' address-family <afi> <safi>'
  cli_nexus:
    config_get: 'show running bgp all'
  cli_ios_xr:
    config_get: 'show running-config router bgp'

additional_paths_install:
  _exclude: [cli_ios_xr]
  kind: boolean
  config_get_token_append: '/^additional-paths install backup$/'
  config_set_append: ' <state> additional-paths install backup'
  default_value: false

additional_paths_receive:
  kind: boolean
  config_get_token_append: '/^additional-paths receive$/'
  config_set_append: ' <state> additional-paths receive'
  default_value: false

additional_paths_selection:
  kind: string
  cli_nexus:
    config_get_token_append: '/^additional-paths selection route-map (.*)$/'
    config_set_append: '<state> additional-paths selection route-map <route_map>'
  cli_ios_xr:
    config_get_token_append: '/^additional-paths selection route-policy (.*)$/'
    config_set_append: ' <state> additional-paths selection route-policy <route_policy>'
  default_value: ""

additional_paths_send:
  kind: boolean
  config_get_token_append: '/^additional-paths send$/'
  config_set_append: ' <state> additional-paths send'
  default_value: false

advertise_l2vpn_evpn:
  _exclude: [cli_ios_xr]
  kind: boolean
  config_get_token_append: '/^advertise l2vpn evpn$/'
  config_set_append: '<state> advertise l2vpn evpn'
  default_value: false

all_afs:
  multiple: true
  config_get_token_append: '/^address-family (\S+) (\S+)$/'

client_to_client:
  kind: boolean
  default_value: true
  cli_nexus:
    config_get_token_append: '/^no client-to-client reflection$/'
    config_set_append: '<state> client-to-client reflection'
  cli_ios_xr:
    config_get_token_append: '/^bgp client-to-client reflection disable$/'
    config_set_append: ' <state> bgp client-to-client reflection disable'

dampen_igp_metric:
  _exclude: [cli_ios_xr]
  auto_default: false
  kind: int
  config_get_token_append: '/^dampen-igp-metric (\d+)$/'
  config_set_append: '<state> dampen-igp-metric <num>'
  default_value: 600

dampening:
  auto_default: false
  cli_nexus:
    config_get_token_append: '/^dampening(?: (?:(\d+) (\d+) (\d+) (\d+)|route-map (.*)))?$/'
    config_set_append: '<state> dampening <route_map> <decay> <reuse> <suppress> <suppress_max>'
  cli_ios_xr:
    config_get_token_append: '/^bgp dampening(?: (?:(\d+) (\d+) (\d+) (\d+)|route-policy (.*)))?$/'
    config_set_append: ' <state> bgp dampening <route_policy> <decay> <reuse> <suppress> <suppress_max>'
  default_value: ""

dampening_half_time:
  default_value: 15

dampening_max_suppress_time:
  default_value: 45

dampening_reuse_time:
  default_value: 750

dampening_routemap:
  default_value: ""

dampening_routepolicy:
  default_value: ""

dampening_state:
  default_value: true

dampening_suppress_time:
  default_value: 2000

default_information:
  _exclude: [cli_ios_xr]
  kind: boolean
  default_value: false
  config_get_token_append: '/^default-information originate$/'
  config_set_append: '<state> default-information originate'

# This is a multi-provider, enable-only feature. Do not disable from provider.
feature_nv_overlay_evpn:
  _exclude: [cli_ios_xr]
  kind: boolean
  config_get: "show running section nv"
  config_get_token: '/^nv overlay evpn$/'
  config_set: "nv overlay evpn"

maximum_paths:
  kind: int
  cli_nexus:
    config_get_token_append: '/^maximum-paths (\d+)$/'
    config_set_append: '<state> maximum-paths <num>'
  cli_ios_xr:
    # BT: Is "maximum-paths" without specialization equal to "maximum-paths ebgp"?
    config_get_token_append: '/^maximum-paths ebgp (\d+)$/'
    config_set_append: ' <state> maximum-paths ebgp <num>'
  default_value: 1

maximum_paths_ibgp:
  kind: int
  config_get_token_append: '/^maximum-paths ibgp (\d+)$/'
  config_set_append: ' <state> maximum-paths ibgp <num>'
  default_value: 1

network:
  multiple: true
  cli_nexus:
    config_get_token_append: '/^network (\S+) ?(?:route-map )?(\S+)?$/'
    config_set_append: '<state> network <network> <route_map>'
  cli_ios_xr:
    config_get_token_append: '/^network (\S+) ?(?:route-policy )?(\S+)?$/'
    config_set_append: ' <state> network <network> <route_policy>'
  default_value: []

next_hop_route_map:
  kind: string
  default_value: ""
  cli_nexus:
    config_get_token_append: '/^nexthop route-map (.*)$/'
    config_set_append: ' <state> nexthop route-map <route_map>'
  cli_ios_xr:
    config_get_token_append: '/nexthop route-policy (.*)$/'
    config_set_append: ' <state> nexthop route-policy <route_map>'

next_hop_route_policy:
  _exclude: [cli_nexus]
  kind: string
  default_value: ""
  config_get_token_append: '/nexthop route-policy (.*)$/'
  config_set_append: ' <state> nexthop route-policy <route_policy>'

redistribute:
  multiple: true
  config_set_append: ' <state> redistribute <protocol>'
  cli_nexus:
    config_get_token_append: '/^redistribute (\S+ ?\S+?) ?(?:route-map (\S+))?$/'
  cli_ios_xr:
    config_get_token_append: '/^redistribute (\S+ ?\S+?) ?(?:route-policy (\S+))?$/'
  default_value: []

redistribute_policy:
  cli_nexus:
    config_set_append: '<state> redistribute <protocol> route-map <policy>'
  cli_ios_xr:
    config_set_append: ' <state> redistribute <protocol> route-policy <policy>'

#config in vrf context
route_target_both_auto:
  config_get: 'sh run | section vrf'
  config_get_token: ['/^vrf context <vrf>$/i', '/^address-family <afi> <safi>$/i', '/^route-target both auto$/']
  config_set: ["vrf context <vrf>", "address-family <afi> <safi>", "<state> route-target both auto"]
  kind: boolean
  default_value: false

route_target_both_auto_evpn:
  config_get: 'sh run | section vrf'
  config_get_token: ['/^vrf context <vrf>$/i', '/^address-family <afi> <safi>$/i', '/^route-target both auto evpn$/']
  config_set: ["vrf context <vrf>", "address-family <afi> <safi>", "<state> route-target both auto evpn"]
  kind: boolean
  default_value: false

route_target_export:
  config_get: 'sh run | section vrf'
  config_get_token: ['/^vrf context <vrf>$/i', '/^address-family <afi> <safi>$/i', '/^route-target export (\S+)$/']
  config_set: ["vrf context <vrf>", "address-family <afi> <safi>", "<state> route-target export <community>"]
  multiple: true
  default_value: []

route_target_export_evpn:
  config_get: 'sh run | section vrf'
  config_get_token: ['/^vrf context <vrf>$/i', '/^address-family <afi> <safi>$/i', '/^route-target export (\S+) evpn$/']
  config_set: ["vrf context <vrf>", "address-family <afi> <safi>", "<state> route-target export <community> evpn"]
  multiple: true
  default_value: []

route_target_import:
  config_get: 'sh run | section vrf'
  config_get_token: ['/^vrf context <vrf>$/i', '/^address-family <afi> <safi>$/i', '/^route-target import (\S+)$/']
  config_set: ["vrf context <vrf>", "address-family <afi> <safi>", "<state> route-target import <community>"]
  multiple: true
  default_value: []

route_target_import_evpn:
  config_get: 'sh run | section vrf'
  config_get_token: ['/^vrf context <vrf>$/i', '/^address-family <afi> <safi>$/i', '/^route-target import (\S+) evpn$/']
  config_set: ["vrf context <vrf>", "address-family <afi> <safi>", "<state> route-target import <community> evpn"]
  multiple: true
  default_value: []
