# vrf.yaml
---
_template:
  cli_nexus:
    config_get: "show running all | section '^vrf context'"
    config_get_token: '/^vrf context <vrf>$/'
    config_get_token_append:
      - '/^address-family <afi> <safi>$/'
    config_set: 'vrf context <vrf>'
    config_set_append:
      - 'address-family <afi> <safi>'
  cli_ios_xr:
    config_get: "show run vrf"
    config_get_token: '/^vrf <vrf>$/i'
    config_get_token_append:
      - '/^address-family <afi> <safi>$/'
    config_set: 'vrf <vrf>'
    config_set_append:
      - 'address-family <afi> <safi>'

address_family:
  cli_nexus:
    config_set: ['vrf context <vrf>', '<state> address-family <afi> <safi>']
  cli_ios_xr:
    config_set: ['vrf <vrf>', '<state> address-family <afi> <safi>']

all_vrf_afs:
  multiple: true
  config_get_token_append: '/^address-family (\S+) (\S+)$/'

all_vrfs:
  multiple: true
  cli_nexus:
    config_get_token: '/^vrf context (.*)/'
  cli_ios_xr:
    config_get_token: '/^vrf (.*)/'

create:
  cli_nexus:
    config_set:  'vrf context <vrf>'
  cli_ios_xr:
    config_set:  'vrf <vrf>'

description:
  config_get_token_append: '/^description (.*)/'
  config_set_append: '<state> description <desc>'
  kind: string
  default_value: ''

destroy:
  cli_nexus:
    config_set: 'no vrf context <vrf>'
  cli_ios_xr:
    config_set: 'no vrf <vrf>'

route_distinguisher:
  # Only configurable under BGP in IOS XR, not under VRF context
  _exclude: [cli_ios_xr]
  config_get_token_append: '/^rd (\S+)$/'
  config_set_append: '<state> rd <rd>'
  default_value: ''

route_target_both_auto:
  _exclude: [cli_ios_xr]
  kind: boolean
  config_get_token_append: '/^route-target both auto$/'
  config_set_append: '<state> route-target both auto'
  default_value: false

route_target_both_auto_evpn:
  _exclude: [cli_ios_xr]
  kind: boolean
  config_get_token_append: '/^route-target both auto evpn$/'
  config_set_append: '<state> route-target both auto evpn'
  default_value: false

route_target_export:
  multiple: true
  default_value: []
  cli_nexus:
    config_get_token_append: '/^route-target export (\S+)$/'
    config_set_append: '<state> route-target export <community>'
  cli_ios_xr:
    config_get_token_append:
      - '/^export route-target$/'
      - '/^(\S+)$/'
    config_set_append: '<state> export route-target <community>'

route_target_export_evpn:
  _exclude: [cli_ios_xr]
  multiple: true
  config_get_token_append: '/^route-target export (\S+) evpn$/'
  config_set_append: '<state> route-target export <community> evpn'
  default_value: []

route_target_import:
  multiple: true
  default_value: []
  cli_nexus:
    config_get_token_append: '/^route-target import (\S+)$/'
    config_set_append: '<state> route-target import <community>'
  cli_ios_xr:
    config_get_token_append:
      - '/^import route-target$/'
      - '/^(\S+)$/'
    config_set_append: '<state> import route-target <community>'

route_target_import_evpn:
  _exclude: [cli_ios_xr]
  multiple: true
  config_get_token_append: '/^route-target import (\S+) evpn$/'
  config_set_append: '<state> route-target import <community> evpn'
  default_value: []

shutdown:
  _exclude: [cli_ios_xr]
  kind: boolean
  config_get_token_append: '/^shutdown$/'
  config_set_append: '<state> shutdown'
  default_value: false

vni: # TBD Should this move to the vni provider as vrf_vni?
  # MT-lite only
  /N9/:
    kind: int
    config_get_token_append: '/^vni (\d+)$/'
    config_set_append: '<state> vni <id>'
    default_value: false
